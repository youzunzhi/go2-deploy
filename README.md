# GO2 运动控制部署项目

这是一个基于ROS2的GO2机器人运动控制部署项目，从Extreme-Parkour-Onboard项目迁移而来，专注于机器人的运动控制能力。

## 项目结构

```
go2-deploy/
├── constants.py          # 常量定义（机器人配置、API常量等）
├── utils.py             # 工具函数（安全检查、状态机、性能监控等）
├── config.py            # 配置管理（机器人配置、部署配置等）
├── robot_controller.py  # 机器人控制基类
├── state_manager.py     # 状态管理器
├── ros_interface.py     # ROS2接口模块
├── run_loco_policy.py   # 主运行脚本（待实现）
└── README.md           # 项目说明文档
```

## 设计哲学

### 1. 模块化设计
- **分离关注点**: 控制逻辑、状态管理、通信接口分别独立
- **可扩展性**: 每个模块都可以独立扩展和优化
- **可测试性**: 模块间松耦合，便于单元测试

### 2. 安全优先
- **多层安全检查**: 关节限位、动作范围、紧急停止
- **实时监控**: 持续监控机器人状态，及时发现问题
- **优雅降级**: 异常情况下安全切换到备用模式

### 3. 性能优化
- **异步处理**: 非阻塞的通信和控制循环
- **内存管理**: 高效的数据缓冲和缓存策略
- **实时性**: 优化的控制周期和响应时间

### 4. 配置驱动
- **灵活配置**: 支持多种配置文件和参数
- **运行时调整**: 支持动态参数调整
- **环境适配**: 适应不同的部署环境

## 核心组件

### 1. 机器人控制器 (`robot_controller.py`)
- **状态管理**: 管理机器人的各种状态和模式
- **安全检查**: 实时监控关节位置和动作安全
- **性能监控**: 跟踪控制循环的性能指标
- **动作执行**: 安全地发送动作到机器人

### 2. 状态管理器 (`state_manager.py`)
- **模式切换**: 在运动模式、站立模式、运动控制模式间切换
- **手柄处理**: 处理无线手柄的输入命令
- **回调系统**: 支持状态变化的回调处理
- **状态追踪**: 记录和报告当前状态信息

### 3. 配置管理 (`config.py`)
- **机器人配置**: 关节参数、控制增益、限位等
- **部署配置**: 设备选择、运行模式、性能参数等
- **动态加载**: 支持配置文件的动态加载和更新

### 4. 工具函数 (`utils.py`)
- **安全检查器**: 关节限位检查、违规计数、紧急停止
- **状态机**: 状态转换逻辑和验证
- **性能计时器**: 精确的性能测量和统计
- **数学工具**: 坐标转换、角度计算等

## 开发计划

### 第一阶段 ✅ 完成
- [x] 基础项目结构
- [x] 常量定义和配置管理
- [x] 工具函数和安全检查机制
- [x] 项目文档

### 第二阶段 ✅ 完成
- [x] 机器人控制基类
- [x] 状态管理器
- [x] ROS2接口模块
- [x] 模块化架构设计

### 第三阶段 🔄 进行中
- [ ] 模型加载和推理逻辑
- [ ] 观察空间处理
- [ ] 动作空间处理
- [ ] 推理性能优化

### 第四阶段 📋 计划中
- [ ] 主运行脚本
- [ ] 完整的控制循环
- [ ] 错误处理和恢复
- [ ] 日志和监控系统

### 第五阶段 📋 计划中
- [ ] 性能测试和优化
- [ ] 安全测试和验证
- [ ] 部署脚本和文档
- [ ] 用户指南和示例

## 使用说明

### 环境要求
- Python 3.8+
- ROS2 Humble
- PyTorch 1.12+
- CUDA 11.0+ (可选，用于GPU加速)

### 安装依赖
```bash
pip install torch numpy rclpy
```

### 运行示例
```bash
# 启动ROS2节点
python3 robot_controller.py

# 运行状态管理器
python3 state_manager.py
```

## 安全特性

### 1. 关节限位保护
- 实时监控所有关节位置
- 防止超出安全范围的动作
- 违规计数和自动停止

### 2. 动作范围检查
- 验证动作命令的合理性
- 防止过大的动作幅度
- 平滑的动作过渡

### 3. 紧急停止机制
- 多级安全检查
- 快速响应异常情况
- 安全的降级策略

### 4. 状态监控
- 持续监控机器人状态
- 异常检测和报告
- 自动恢复机制

## 性能特性

### 1. 实时控制
- 优化的控制循环
- 低延迟的响应时间
- 稳定的控制频率

### 2. 内存优化
- 高效的数据结构
- 最小化内存分配
- 智能的缓存策略

### 3. 计算优化
- GPU加速支持
- 批量处理优化
- 并行计算利用

## 扩展性

### 1. 新机器人支持
- 模块化的机器人接口
- 配置驱动的参数设置
- 插件式的功能扩展

### 2. 新算法集成
- 标准化的推理接口
- 灵活的模型加载
- 可配置的处理流程

### 3. 新功能添加
- 事件驱动的架构
- 回调机制支持
- 插件系统设计

## 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发送邮件
- 参与讨论

---

**注意**: 这是一个正在开发中的项目，部分功能可能尚未完全实现。请在使用前仔细阅读文档并进行充分测试。 